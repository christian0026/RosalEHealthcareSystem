<UserControl x:Class="RosalEHealthcare.UI.WPF.Controls.NotificationPopup"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="500" d:DesignWidth="380"
             Width="380">

    <UserControl.Resources>
        <!-- Notification Item Button Style -->
        <Style x:Key="NotificationItemButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                              VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Action Button Style -->
        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#2E7D32"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                Padding="{TemplateBinding Padding}"
                                CornerRadius="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E8F5E9"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#C8E6C9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Delete Button Style -->
        <Style x:Key="DeleteButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#999"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="12">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#FFEBEE"/>
                                <Setter Property="Foreground" Value="#F44336"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Tab Button Style -->
        <Style x:Key="TabButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="BorderThickness" Value="0,0,0,2"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Active Tab Button Style -->
        <Style x:Key="TabButtonActive" TargetType="Button" BasedOn="{StaticResource TabButton}">
            <Setter Property="Foreground" Value="#2E7D32"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderBrush" Value="#2E7D32"/>
        </Style>
    </UserControl.Resources>

    <Border Background="White" 
            CornerRadius="12" 
            BorderBrush="#E0E0E0" 
            BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect Color="#000000" BlurRadius="20" ShadowDepth="5" Opacity="0.15"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Border Grid.Row="0" 
                    Background="#FAFAFA" 
                    CornerRadius="12,12,0,0"
                    Padding="16,14">
                <Grid>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <materialDesign:PackIcon Kind="Bell" 
                                                 Width="22" Height="22" 
                                                 Foreground="#2E7D32"
                                                 VerticalAlignment="Center"/>
                        <TextBlock Text="Notifications" 
                                   FontSize="16" 
                                   FontWeight="SemiBold" 
                                   Foreground="#333"
                                   VerticalAlignment="Center"
                                   Margin="10,0,0,0"/>
                        <Border x:Name="HeaderBadge"
                                Background="#F44336"
                                CornerRadius="10"
                                Padding="8,2"
                                Margin="10,0,0,0"
                                VerticalAlignment="Center"
                                Visibility="Collapsed">
                            <TextBlock x:Name="HeaderBadgeCount"
                                       Text="0"
                                       Foreground="White"
                                       FontSize="11"
                                       FontWeight="Bold"/>
                        </Border>
                    </StackPanel>

                    <!-- Close Button -->
                    <Button x:Name="BtnClose"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center"
                            Width="28" Height="28"
                            Background="Transparent"
                            BorderThickness="0"
                            Cursor="Hand"
                            Click="BtnClose_Click">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" 
                                        Background="{TemplateBinding Background}" 
                                        CornerRadius="14">
                                    <materialDesign:PackIcon Kind="Close" 
                                                             Width="18" Height="18" 
                                                             Foreground="#999"
                                                             HorizontalAlignment="Center"
                                                             VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#EEEEEE"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>
            </Border>

            <!-- Tabs -->
            <Border Grid.Row="1" BorderBrush="#E8E8E8" BorderThickness="0,0,0,1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button x:Name="BtnTabAll"
                            Grid.Column="0"
                            Content="All"
                            Style="{StaticResource TabButtonActive}"
                            Click="BtnTabAll_Click"/>

                    <Button x:Name="BtnTabUnread"
                            Grid.Column="1"
                            Style="{StaticResource TabButton}"
                            Click="BtnTabUnread_Click">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Unread"/>
                            <Border x:Name="UnreadTabBadge"
                                    Background="#FF5722"
                                    CornerRadius="8"
                                    Padding="6,1"
                                    Margin="6,0,0,0"
                                    Visibility="Collapsed">
                                <TextBlock x:Name="UnreadTabCount"
                                           Text="0"
                                           Foreground="White"
                                           FontSize="10"
                                           FontWeight="Bold"/>
                            </Border>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <!-- Notification List -->
            <ScrollViewer Grid.Row="2" 
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          MaxHeight="400">
                <StackPanel>
                    <!-- Notifications ItemsControl -->
                    <ItemsControl x:Name="NotificationsList">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Style="{StaticResource NotificationItemButton}"
                                        Click="NotificationItem_Click"
                                        Tag="{Binding Id}">
                                    <Border x:Name="ItemBorder"
                                            Padding="14,12"
                                            BorderBrush="#F0F0F0"
                                            BorderThickness="0,0,0,1">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <!-- Icon -->
                                            <Border Grid.Column="0"
                                                    Width="40" Height="40"
                                                    CornerRadius="20"
                                                    Background="{Binding Color, Converter={StaticResource ColorToLightBackgroundConverter}, FallbackValue=#F5F5F5}"
                                                    Margin="0,0,12,0"
                                                    VerticalAlignment="Top">
                                                <materialDesign:PackIcon Kind="{Binding Icon, FallbackValue=Bell}"
                                                                         Width="20" Height="20"
                                                                         Foreground="{Binding Color, FallbackValue=#666}"
                                                                         HorizontalAlignment="Center"
                                                                         VerticalAlignment="Center"/>
                                            </Border>

                                            <!-- Content -->
                                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                <TextBlock Text="{Binding Title}"
                                                           FontSize="13"
                                                           FontWeight="{Binding IsRead, Converter={StaticResource ReadToFontWeightConverter}, FallbackValue=SemiBold}"
                                                           Foreground="#333"
                                                           TextTrimming="CharacterEllipsis"
                                                           MaxWidth="220"/>
                                                <TextBlock Text="{Binding Message}"
                                                           FontSize="12"
                                                           Foreground="#666"
                                                           TextWrapping="Wrap"
                                                           MaxHeight="36"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="0,3,0,0"/>
                                                <TextBlock Text="{Binding TimeAgo}"
                                                           FontSize="11"
                                                           Foreground="#999"
                                                           Margin="0,4,0,0"/>
                                            </StackPanel>

                                            <!-- Unread Indicator & Delete -->
                                            <StackPanel Grid.Column="2" 
                                                        VerticalAlignment="Top"
                                                        HorizontalAlignment="Right">
                                                <!-- Unread Dot -->
                                                <Ellipse x:Name="UnreadDot"
                                                         Width="8" Height="8"
                                                         Fill="#2E7D32"
                                                         Margin="0,4,0,8"
                                                         HorizontalAlignment="Center"
                                                         Visibility="{Binding IsRead, Converter={StaticResource InverseBoolToVisibilityConverter}, FallbackValue=Visible}"/>

                                                <!-- Delete Button -->
                                                <Button Style="{StaticResource DeleteButton}"
                                                        Click="BtnDeleteNotification_Click"
                                                        Tag="{Binding Id}"
                                                        ToolTip="Delete notification">
                                                    <materialDesign:PackIcon Kind="Close" Width="14" Height="14"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- Empty State -->
                    <StackPanel x:Name="EmptyState"
                                Visibility="Collapsed"
                                HorizontalAlignment="Center"
                                Margin="0,60,0,60">
                        <Border Width="70" Height="70"
                                CornerRadius="35"
                                Background="#F5F5F5"
                                HorizontalAlignment="Center"
                                Margin="0,0,0,16">
                            <materialDesign:PackIcon Kind="BellOff"
                                                     Width="32" Height="32"
                                                     Foreground="#BDBDBD"
                                                     HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock x:Name="EmptyStateTitle"
                                   Text="No notifications"
                                   FontSize="15"
                                   FontWeight="SemiBold"
                                   Foreground="#666"
                                   HorizontalAlignment="Center"/>
                        <TextBlock x:Name="EmptyStateMessage"
                                   Text="You're all caught up!"
                                   FontSize="12"
                                   Foreground="#999"
                                   HorizontalAlignment="Center"
                                   Margin="0,4,0,0"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <!-- Footer Actions -->
            <Border Grid.Row="3" 
                    Background="#FAFAFA" 
                    CornerRadius="0,0,12,12"
                    Padding="12,10"
                    BorderBrush="#E8E8E8"
                    BorderThickness="0,1,0,0">
                <Grid>
                    <Button x:Name="BtnMarkAllRead"
                            Content="Mark all as read"
                            Style="{StaticResource ActionButton}"
                            HorizontalAlignment="Left"
                            Click="BtnMarkAllRead_Click"/>

                    <Button x:Name="BtnClearAll"
                            HorizontalAlignment="Right"
                            Style="{StaticResource ActionButton}"
                            Foreground="#F44336"
                            Click="BtnClearAll_Click">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="DeleteOutline" 
                                                     Width="16" Height="16" 
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,4,0"/>
                            <TextBlock Text="Clear read"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>
        </Grid>
    </Border>
</UserControl>