<UserControl x:Class="RosalEHealthcare.UI.WPF.Views.DoctorPatientRecords"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:RosalEHealthcare.UI.WPF.Converters"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             MinWidth="700" MinHeight="500" Background="#F5F5F5">

    <UserControl.Resources>
        <conv:StringNullOrEmptyToVisibilityConverter x:Key="StringNullOrEmptyToVisibilityConverter"/>
        <conv:NameInitialsConverter x:Key="NameInitialsConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Button Styles -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#45A049"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#E05A4F"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#D32F2F"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#2196F3"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1976D2"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT PANEL: Patient List -->
        <Border Grid.Column="0" Background="White" Margin="10" CornerRadius="12" Padding="15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Search Box -->
                <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="1" 
                       CornerRadius="8" Margin="0,0,0,10">
                    <Grid>
                        <TextBox x:Name="txtSearch" Height="40" Padding="35,0,10,0" 
                                BorderThickness="0" Background="Transparent"
                                VerticalContentAlignment="Center"
                                TextChanged="TxtSearch_TextChanged"/>
                        <materialDesign:PackIcon Kind="Magnify" 
                                               Width="20" Height="20"
                                               Foreground="#999"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Left"
                                               Margin="10,0,0,0"/>
                        <TextBlock Text="Search patients..." 
                                  IsHitTestVisible="False"
                                  Foreground="#999"
                                  VerticalAlignment="Center"
                                  Margin="35,0,0,0"
                                  Visibility="{Binding Text, ElementName=txtSearch, Converter={StaticResource StringNullOrEmptyToVisibilityConverter}}"/>
                    </Grid>
                </Border>

                <!-- Filter Buttons -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                    <Button x:Name="btnFilterAll" Content="All" Click="BtnFilter_Click" 
                           Tag="All" Margin="0,0,5,0" Padding="10,5"
                           Background="#4CAF50" Foreground="White" BorderThickness="0"/>
                    <Button x:Name="btnFilterRecent" Content="Recent" Click="BtnFilter_Click" 
                           Tag="Recent" Margin="0,0,5,0" Padding="10,5"
                           Background="White" Foreground="#666" BorderThickness="1" BorderBrush="#E0E0E0"/>
                    <Button x:Name="btnFilterFollowUp" Content="Follow-up" Click="BtnFilter_Click" 
                           Tag="FollowUp" Padding="10,5"
                           Background="White" Foreground="#666" BorderThickness="1" BorderBrush="#E0E0E0"/>
                </StackPanel>

                <!-- Patient List -->
                <ListView x:Name="lvPatients" Grid.Row="3" 
                         Background="Transparent" BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         SelectionChanged="LvPatients_SelectionChanged">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Border x:Name="border" Background="Transparent" 
                                               CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#E8F5E9"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="50"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar -->
                                <Grid Grid.Column="0" Width="45" Height="45">
                                    <Ellipse Fill="#4CAF50"/>
                                    <TextBlock Text="{Binding FullName, Converter={StaticResource NameInitialsConverter}}"
                                              Foreground="White" FontWeight="Bold"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"
                                              FontSize="14"/>
                                </Grid>

                                <!-- Info -->
                                <StackPanel Grid.Column="1" Margin="10,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding FullName}" FontWeight="SemiBold" FontSize="14"/>
                                    <TextBlock Text="{Binding PatientId}" FontSize="11" Foreground="#999"/>
                                    <TextBlock Text="{Binding PrimaryDiagnosis}" FontSize="11" Foreground="#666"/>
                                </StackPanel>

                                <!-- Badge -->
                                <Border Grid.Column="2" Background="#FFF3E0" CornerRadius="4" 
                                       Padding="6,2" VerticalAlignment="Top" Margin="0,5,0,0">
                                    <TextBlock Text="RECENT" FontSize="9" FontWeight="Bold" 
                                              Foreground="#FF9800"/>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- No Results -->
                <StackPanel Grid.Row="3" HorizontalAlignment="Center" VerticalAlignment="Center"
                           Visibility="{Binding ElementName=lvPatients, Path=Items.Count, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <materialDesign:PackIcon Kind="AccountSearch" Width="60" Height="60" Foreground="#CCC"/>
                    <TextBlock Text="No patients found" Foreground="#999" Margin="0,10,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- RIGHT PANEL: Patient Details -->
        <Grid Grid.Column="1" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- HEADER CARD -->
            <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="20" Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Avatar -->
                    <Grid Grid.Column="0" Width="72" Height="72" Margin="0,0,15,0">
                        <Ellipse Fill="#4CAF50"/>
                        <TextBlock Text="{Binding SelectedPatient.FullName, Converter={StaticResource NameInitialsConverter}, TargetNullValue='--'}"
                                  Foreground="White" FontWeight="Bold" FontSize="24"
                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Info -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock Text="{Binding SelectedPatient.FullName, TargetNullValue='No Patient Selected'}"
                                  FontSize="22" FontWeight="Bold" Foreground="#333"/>
                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                            <Border Background="#E3F2FD" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                                <TextBlock Text="{Binding SelectedPatient.PatientId}" 
                                          FontSize="12" Foreground="#2196F3" FontWeight="Medium"/>
                            </Border>
                            <Border Background="#E8F5E9" CornerRadius="4" Padding="8,4" Margin="0,0,8,0">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding SelectedPatient.Age}" 
                                              FontSize="12" Foreground="#4CAF50" FontWeight="Medium"/>
                                    <TextBlock Text=" yrs • " 
                                              FontSize="12" Foreground="#4CAF50" FontWeight="Medium"/>
                                    <TextBlock Text="{Binding SelectedPatient.Gender}" 
                                              FontSize="12" Foreground="#4CAF50" FontWeight="Medium"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                        <TextBlock Text="{Binding SelectedPatient.PrimaryDiagnosis}" 
                                  FontSize="13" Foreground="#666" Margin="0,5,0,0"/>
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button Content="Edit" Click="BtnEdit_Click" 
                               Style="{StaticResource SecondaryButton}" Margin="0,0,8,0">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Pencil" Width="16" Height="16" Margin="0,0,5,0"/>
                                        <TextBlock Text="Edit"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                        <Button Content="Archive" Click="BtnArchive_Click" 
                               Style="{StaticResource DangerButton}" Margin="0,0,8,0">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Archive" Width="16" Height="16" Margin="0,0,5,0"/>
                                        <TextBlock Text="Archive"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                        <Button Content="Print" Click="BtnPrint_Click" 
                               Style="{StaticResource PrimaryButton}">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Printer" Width="16" Height="16" Margin="0,0,5,0"/>
                                        <TextBlock Text="Print"/>
                                    </StackPanel>
                                </DataTemplate>
                            </Button.ContentTemplate>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- TAB BUTTONS -->
            <Border Grid.Row="1" Background="White" CornerRadius="12" Padding="15" Margin="0,0,0,15">
                <StackPanel Orientation="Horizontal">
                    <RadioButton x:Name="rbPersonal" Content="Personal Information" 
                                GroupName="PatientTabs" IsChecked="True" 
                                Checked="Tab_Checked" Style="{StaticResource {x:Type RadioButton}}"
                                Margin="0,0,15,0"/>
                    <RadioButton x:Name="rbMedical" Content="Medical History" 
                                GroupName="PatientTabs" Checked="Tab_Checked"
                                Margin="0,0,15,0"/>
                    <RadioButton x:Name="rbVisits" Content="Visit History" 
                                GroupName="PatientTabs" Checked="Tab_Checked"
                                Margin="0,0,15,0"/>
                    <RadioButton x:Name="rbPrescription" Content="Prescriptions" 
                                GroupName="PatientTabs" Checked="Tab_Checked"/>
                </StackPanel>
            </Border>

            <!-- CONTENT AREA -->
            <Border Grid.Row="2" Background="White" CornerRadius="12" Padding="20">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <Grid>
                        <!-- PERSONAL INFORMATION TAB -->
                        <Grid x:Name="panelPersonal" Visibility="Visible">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Personal Details Section -->
                            <StackPanel Grid.Row="0">
                                <TextBlock Text="Personal Details" FontSize="16" FontWeight="SemiBold" 
                                          Foreground="#333" Margin="0,0,0,15"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                        <TextBlock Text="Full Name" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.FullName, TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                        <TextBlock Text="Date of Birth" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.BirthDate, StringFormat='MMMM dd, yyyy', TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                        <TextBlock Text="Age" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.Age, StringFormat='{}{0} years', TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                        <TextBlock Text="Gender" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.Gender, TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Phone Number" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.Contact, TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                        <TextBlock Text="Email" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.Email, TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                        <TextBlock Text="Address" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SelectedPatient.Address, TargetNullValue='—'}" 
                                                  FontSize="14" FontWeight="Medium" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <!-- Medical Information Section -->
                            <Border Grid.Row="1" Background="#F9F9F9" CornerRadius="8" 
                                   Padding="15" Margin="0,20,0,0">
                                <StackPanel>
                                    <TextBlock Text="Medical Information" FontSize="16" FontWeight="SemiBold" 
                                              Foreground="#333" Margin="0,0,0,15"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                            <TextBlock Text="Blood Type" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.BloodType, TargetNullValue='N/A'}" 
                                                      FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                            <TextBlock Text="Height" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.Height, StringFormat='{}{0} cm', TargetNullValue='—'}" 
                                                      FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                            <TextBlock Text="Weight" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.Weight, StringFormat='{}{0} kg', TargetNullValue='—'}" 
                                                      FontSize="14" FontWeight="Medium"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Allergies" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.Allergies, TargetNullValue='None reported'}" 
                                                      FontSize="14" FontWeight="Medium" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Current Conditions Section -->
                            <Border Grid.Row="2" Background="#FFF3E0" CornerRadius="8" 
                                   Padding="15" Margin="0,15,0,0">
                                <StackPanel>
                                    <TextBlock Text="Current Conditions" FontSize="16" FontWeight="SemiBold" 
                                              Foreground="#333" Margin="0,0,0,15"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                            <TextBlock Text="Primary Diagnosis" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.PrimaryDiagnosis, TargetNullValue='—'}" 
                                                      FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                            <TextBlock Text="Secondary Diagnosis" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.SecondaryDiagnosis, TargetNullValue='—'}" 
                                                      FontSize="14" FontWeight="Medium"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock Text="Last Visit" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="{Binding SelectedPatient.LastVisit, StringFormat='MMMM dd, yyyy', TargetNullValue='—'}" 
                                                      FontSize="14" FontWeight="Medium" Margin="0,0,0,15"/>

                                            <TextBlock Text="Next Appointment" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock Text="February 15, 2025" 
                                                      FontSize="14" FontWeight="Medium" Foreground="#4CAF50"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Clinical Notes -->
                            <StackPanel Grid.Row="3" Margin="0,20,0,0">
                                <TextBlock Text="Clinical Notes" FontSize="16" FontWeight="SemiBold" 
                                          Foreground="#333" Margin="0,0,0,10"/>
                                <Border Background="#F9F9F9" CornerRadius="8" Padding="15">
                                    <TextBlock Text="Patient shows good compliance with medication regimen. Blood pressure readings have been stable over the past 3 months. Continue current dosage of Amlodipine 5mg. Schedule follow-up in 4 weeks to monitor blood glucose levels." 
                                              TextWrapping="Wrap" FontSize="13" Foreground="#666" LineHeight="22"/>
                                </Border>
                            </StackPanel>
                        </Grid>

                        <!-- MEDICAL HISTORY TAB -->
                        <Grid x:Name="panelMedical" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,15">
                                <TextBlock Text="Medical History Timeline" FontSize="18" FontWeight="SemiBold" 
                                          Foreground="#333" VerticalAlignment="Center"/>
                                <Button Content="Add Record" Click="BtnAddMedicalHistory_Click"
                                       HorizontalAlignment="Right" Style="{StaticResource PrimaryButton}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" Margin="0,0,5,0"/>
                                                <TextBlock Text="Add Record"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                            </Grid>

                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="icMedicalHistory">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F9F9F9" CornerRadius="8" Padding="15" Margin="0,0,0,10">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Timeline Indicator -->
                                                    <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                                        <Ellipse Width="12" Height="12" Fill="#4CAF50"/>
                                                        <Rectangle Width="2" Height="60" Fill="#E0E0E0" 
                                                                  HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                                    </StackPanel>

                                                    <!-- Content -->
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding VisitDate, StringFormat='MMMM dd, yyyy'}" 
                                                                  FontSize="13" Foreground="#999" Margin="0,0,0,5"/>
                                                        <TextBlock Text="{Binding Diagnosis}" FontSize="15" 
                                                                  FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                                        <TextBlock Text="{Binding Treatment}" FontSize="13" 
                                                                  Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,8"/>

                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>

                                                            <StackPanel Grid.Column="0">
                                                                <TextBlock Text="Vital Signs" FontSize="11" 
                                                                          Foreground="#999" Margin="0,0,0,3"/>
                                                                <TextBlock FontSize="12" Foreground="#666">
                                                                    <Run Text="BP: "/><Run Text="{Binding BloodPressure, TargetNullValue='—'}"/>
                                                                    <Run Text=" | Temp: "/><Run Text="{Binding Temperature, StringFormat='{}{0}°C', TargetNullValue='—'}"/>
                                                                </TextBlock>
                                                            </StackPanel>

                                                            <StackPanel Grid.Column="1">
                                                                <TextBlock Text="Doctor" FontSize="11" 
                                                                          Foreground="#999" Margin="0,0,0,3"/>
                                                                <TextBlock Text="{Binding DoctorName}" 
                                                                          FontSize="12" Foreground="#666"/>
                                                            </StackPanel>
                                                        </Grid>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>

                        <!-- VISIT HISTORY TAB -->
                        <Grid x:Name="panelVisits" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Visit History" FontSize="18" 
                                      FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,15"/>

                            <DataGrid Grid.Row="1" x:Name="dgVisitHistory" 
                                     AutoGenerateColumns="False"
                                     CanUserAddRows="False"
                                     HeadersVisibility="Column"
                                     GridLinesVisibility="None"
                                     Background="Transparent"
                                     BorderThickness="0">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Date" Binding="{Binding VisitDate, StringFormat='MMM dd, yyyy'}" Width="120"/>
                                    <DataGridTextColumn Header="Type" Binding="{Binding VisitType}" Width="100"/>
                                    <DataGridTextColumn Header="Diagnosis" Binding="{Binding Diagnosis}" Width="*"/>
                                    <DataGridTextColumn Header="Doctor" Binding="{Binding DoctorName}" Width="150"/>
                                    <DataGridTemplateColumn Header="Actions" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="View" Click="BtnViewVisit_Click" 
                                                       Padding="8,4" Background="#2196F3" 
                                                       Foreground="White" BorderThickness="0"/>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Grid>

                        <!-- PRESCRIPTIONS TAB -->
                        <Grid x:Name="panelPrescription" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,15">
                                <TextBlock Text="Prescription History" FontSize="18" 
                                          FontWeight="SemiBold" Foreground="#333" 
                                          VerticalAlignment="Center"/>
                                <Button Content="New Prescription" Click="BtnNewPrescription_Click"
                                       HorizontalAlignment="Right" 
                                       Style="{StaticResource PrimaryButton}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <materialDesign:PackIcon Kind="Plus" Width="16" Height="16" Margin="0,0,5,0"/>
                                                <TextBlock Text="New Prescription"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                </Button>
                            </Grid>

                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="icPrescriptions">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F9F9F9" CornerRadius="8" 
                                                   Padding="15" Margin="0,0,0,10">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Header -->
                                                    <Grid Grid.Row="0" Margin="0,0,0,10">
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding PrescriptionId}" 
                                                                      FontSize="14" FontWeight="SemiBold" 
                                                                      Foreground="#333"/>
                                                            <TextBlock Text="{Binding CreatedAt, StringFormat='Prescribed on {0:MMMM dd, yyyy}'}" 
                                                                      FontSize="12" Foreground="#999" 
                                                                      Margin="0,3,0,0"/>
                                                        </StackPanel>
                                                        <Button Content="View Details" 
                                                               Click="BtnViewPrescription_Click"
                                                               HorizontalAlignment="Right"
                                                               Padding="10,5" Background="#2196F3" 
                                                               Foreground="White" BorderThickness="0"/>
                                                    </Grid>

                                                    <!-- Diagnosis -->
                                                    <StackPanel Grid.Row="1" Margin="0,0,0,10">
                                                        <TextBlock Text="Diagnosis" FontSize="11" 
                                                                  Foreground="#999" Margin="0,0,0,3"/>
                                                        <TextBlock Text="{Binding PrimaryDiagnosis}" 
                                                                  FontSize="13" Foreground="#666"/>
                                                    </StackPanel>

                                                    <!-- Medicines -->
                                                    <StackPanel Grid.Row="2">
                                                        <TextBlock Text="Medicines Prescribed" 
                                                                  FontSize="11" Foreground="#999" 
                                                                  Margin="0,0,0,5"/>
                                                        <ItemsControl ItemsSource="{Binding Medicines}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border Background="White" 
                                                                           CornerRadius="4" Padding="8" 
                                                                           Margin="0,0,0,5">
                                                                        <Grid>
                                                                            <StackPanel>
                                                                                <TextBlock Text="{Binding MedicineName}" 
                                                                                          FontSize="13" 
                                                                                          FontWeight="Medium" 
                                                                                          Foreground="#333"/>
                                                                                <TextBlock FontSize="11" 
                                                                                          Foreground="#666" 
                                                                                          Margin="0,2,0,0">
                                                                                    <Run Text="{Binding Dosage}"/>
                                                                                    <Run Text=" • "/>
                                                                                    <Run Text="{Binding Frequency}"/>
                                                                                    <Run Text=" • "/>
                                                                                    <Run Text="{Binding Duration}"/>
                                                                                </TextBlock>
                                                                            </StackPanel>
                                                                        </Grid>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</UserControl>