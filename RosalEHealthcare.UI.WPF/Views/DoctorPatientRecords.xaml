<UserControl x:Class="RosalEHealthcare.UI.WPF.Views.DoctorPatientRecords"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:RosalEHealthcare.UI.WPF.Converters"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             MinWidth="700" MinHeight="500" Background="#F5F5F5">

    <UserControl.Resources>
        <conv:StringNullOrEmptyToVisibilityConverter x:Key="StringNullOrEmptyToVisibilityConverter"/>
        <conv:NameInitialsConverter x:Key="NameInitialsConverter"/>
        <conv:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Filter Button Style -->
        <Style x:Key="FilterButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FilterButtonActiveStyle" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#43A047"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Action Button Styles -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#4CAF50"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#45A049"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DangerButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#E53935"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#C62828"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Background" Value="#2196F3"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1976D2"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#BDBDBD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Tab Radio Button Style -->
        <Style x:Key="TabRadioStyle" TargetType="RadioButton">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#666"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse x:Name="indicator" Width="8" Height="8" 
                                        Fill="#E0E0E0" Margin="0,0,8,0" VerticalAlignment="Center"/>
                                <ContentPresenter VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="indicator" Property="Fill" Value="#4CAF50"/>
                                <Setter Property="Foreground" Value="#333"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="380"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- LEFT PANEL: Patient List -->
        <Border Grid.Column="0" Background="White" Margin="15" CornerRadius="12">
            <Border.Effect>
                <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="2" Opacity="0.08"/>
            </Border.Effect>
            <Grid Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Refresh Button -->
                <Button Grid.Row="0" Content="↻ Refresh" Click="BtnRefresh_Click"
                       HorizontalAlignment="Right" Padding="8,4"
                       Background="Transparent" Foreground="#4CAF50" 
                       BorderThickness="0" FontSize="12" Cursor="Hand"
                       Margin="0,0,0,10"/>

                <!-- Search Box -->
                <Border Grid.Row="1" BorderBrush="#E0E0E0" BorderThickness="1" 
                       CornerRadius="8" Margin="0,0,0,12" Height="42">
                    <Grid>
                        <TextBox x:Name="txtSearch" Height="40" Padding="38,0,10,0" 
                                BorderThickness="0" Background="Transparent"
                                VerticalContentAlignment="Center" FontSize="14"
                                TextChanged="TxtSearch_TextChanged"/>
                        <materialDesign:PackIcon Kind="Magnify" 
                                               Width="20" Height="20"
                                               Foreground="#999"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Left"
                                               Margin="12,0,0,0"/>
                        <TextBlock Text="Search patients..." 
                                  IsHitTestVisible="False"
                                  Foreground="#999"
                                  FontSize="14"
                                  VerticalAlignment="Center"
                                  Margin="38,0,0,0"
                                  Visibility="{Binding Text, ElementName=txtSearch, Converter={StaticResource StringNullOrEmptyToVisibilityConverter}}"/>
                    </Grid>
                </Border>

                <!-- Filter Buttons -->
                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,12">
                    <Button x:Name="btnFilterAll" Content="ALL" Click="BtnFilter_Click" 
                           Tag="All" Margin="0,0,8,0"
                           Style="{StaticResource FilterButtonActiveStyle}"/>
                    <Button x:Name="btnFilterRecent" Content="RECENT" Click="BtnFilter_Click" 
                           Tag="Recent" Margin="0,0,8,0"
                           Style="{StaticResource FilterButtonStyle}"/>
                    <Button x:Name="btnFilterFollowUp" Content="FOLLOW-UP" Click="BtnFilter_Click" 
                           Tag="FollowUp"
                           Style="{StaticResource FilterButtonStyle}"/>
                </StackPanel>

                <!-- Patient List -->
                <ListView x:Name="lvPatients" Grid.Row="3" 
                         Background="Transparent" BorderThickness="0"
                         ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                         SelectionChanged="LvPatients_SelectionChanged">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Border x:Name="border" Background="Transparent" 
                                               CornerRadius="8" Padding="12" Margin="0,0,0,8"
                                               BorderThickness="1" BorderBrush="Transparent">
                                            <ContentPresenter/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#E8F5E9"/>
                                                <Setter TargetName="border" Property="BorderBrush" Value="#4CAF50"/>
                                            </Trigger>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#F5F5F5"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </ListView.ItemContainerStyle>
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar -->
                                <Grid Grid.Column="0" Width="45" Height="45">
                                    <Ellipse Fill="#4CAF50"/>
                                    <TextBlock Text="{Binding FullName, Converter={StaticResource NameInitialsConverter}}"
                                              Foreground="White" FontWeight="Bold"
                                              HorizontalAlignment="Center" VerticalAlignment="Center"
                                              FontSize="14"/>
                                </Grid>

                                <!-- Info -->
                                <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding FullName}" FontWeight="SemiBold" FontSize="14" Foreground="#333"/>
                                    <TextBlock Text="{Binding PatientId}" FontSize="11" Foreground="#999" Margin="0,2,0,0"/>
                                    <TextBlock Text="{Binding PrimaryDiagnosis}" FontSize="11" Foreground="#666" 
                                              TextTrimming="CharacterEllipsis" MaxWidth="180"/>
                                </StackPanel>

                                <!-- Badge -->
                                <Border Grid.Column="2" Background="#FFF3E0" CornerRadius="4" 
                                       Padding="8,3" VerticalAlignment="Top">
                                    <TextBlock Text="RECENT" FontSize="9" FontWeight="Bold" 
                                              Foreground="#FF9800"/>
                                </Border>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>

                <!-- No Results Message -->
                <StackPanel x:Name="pnlNoResults" Grid.Row="3" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Visibility="Collapsed">
                    <materialDesign:PackIcon Kind="AccountSearch" Width="60" Height="60" Foreground="#CCC"/>
                    <TextBlock Text="No patients found" Foreground="#999" Margin="0,10,0,0" FontSize="14"/>
                </StackPanel>

                <!-- Loading Indicator -->
                <StackPanel x:Name="pnlLoading" Grid.Row="3" 
                           HorizontalAlignment="Center" VerticalAlignment="Center"
                           Visibility="Collapsed">
                    <materialDesign:PackIcon Kind="Loading" Width="40" Height="40" Foreground="#4CAF50"
                                            RenderTransformOrigin="0.5,0.5">
                        <materialDesign:PackIcon.RenderTransform>
                            <RotateTransform x:Name="LoadingRotation"/>
                        </materialDesign:PackIcon.RenderTransform>
                    </materialDesign:PackIcon>
                    <TextBlock Text="Loading..." Foreground="#666" Margin="0,10,0,0" FontSize="13"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- RIGHT PANEL: Patient Details -->
        <Grid Grid.Column="1" Margin="0,15,15,15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- HEADER CARD -->
            <Border Grid.Row="0" Background="White" CornerRadius="12" Padding="20" Margin="0,0,0,15">
                <Border.Effect>
                    <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="2" Opacity="0.08"/>
                </Border.Effect>
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Avatar -->
                    <Grid Grid.Column="0" Width="72" Height="72" Margin="0,0,18,0">
                        <Ellipse Fill="#4CAF50"/>
                        <TextBlock x:Name="txtHeaderInitials" Text="--"
                                  Foreground="White" FontWeight="Bold" FontSize="24"
                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Info -->
                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                        <TextBlock x:Name="txtHeaderName" Text="No Patient Selected"
                                  FontSize="22" FontWeight="Bold" Foreground="#333"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                            <Border x:Name="bdrPatientId" Background="#E3F2FD" CornerRadius="4" Padding="10,5" Margin="0,0,8,0">
                                <TextBlock x:Name="txtHeaderPatientId" Text="--" 
                                          FontSize="12" Foreground="#2196F3" FontWeight="Medium"/>
                            </Border>
                            <Border Background="#E8F5E9" CornerRadius="4" Padding="10,5">
                                <TextBlock x:Name="txtHeaderAgeGender" Text="-- yrs • --" 
                                          FontSize="12" Foreground="#4CAF50" FontWeight="Medium"/>
                            </Border>
                        </StackPanel>
                        <TextBlock x:Name="txtHeaderDiagnosis" Text="" 
                                  FontSize="13" Foreground="#666" Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button x:Name="btnEdit" Click="BtnEdit_Click" 
                               Style="{StaticResource SecondaryButton}" Margin="0,0,8,0"
                               IsEnabled="False">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Pencil" Width="16" Height="16" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Edit" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="btnArchive" Click="BtnArchive_Click" 
                               Style="{StaticResource DangerButton}" Margin="0,0,8,0"
                               IsEnabled="False">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Archive" Width="16" Height="16" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Archive" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                        <Button x:Name="btnPrint" Click="BtnPrint_Click" 
                               Style="{StaticResource PrimaryButton}"
                               IsEnabled="False">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Printer" Width="16" Height="16" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="Print" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- TAB BUTTONS -->
            <Border Grid.Row="1" Background="White" CornerRadius="12" Padding="15,10" Margin="0,0,0,15">
                <Border.Effect>
                    <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="2" Opacity="0.08"/>
                </Border.Effect>
                <StackPanel Orientation="Horizontal">
                    <RadioButton x:Name="rbPersonal" Content="Personal Information" 
                                GroupName="PatientTabs" IsChecked="True" 
                                Checked="Tab_Checked" Style="{StaticResource TabRadioStyle}"
                                Margin="0,0,10,0"/>
                    <RadioButton x:Name="rbMedical" Content="Medical History" 
                                GroupName="PatientTabs" Checked="Tab_Checked"
                                Style="{StaticResource TabRadioStyle}"
                                Margin="0,0,10,0"/>
                    <RadioButton x:Name="rbVisits" Content="Visit History" 
                                GroupName="PatientTabs" Checked="Tab_Checked"
                                Style="{StaticResource TabRadioStyle}"
                                Margin="0,0,10,0"/>
                    <RadioButton x:Name="rbPrescription" Content="Prescriptions" 
                                GroupName="PatientTabs" Checked="Tab_Checked"
                                Style="{StaticResource TabRadioStyle}"/>
                </StackPanel>
            </Border>

            <!-- CONTENT AREA -->
            <Border Grid.Row="2" Background="White" CornerRadius="12" Padding="20">
                <Border.Effect>
                    <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="2" Opacity="0.08"/>
                </Border.Effect>
                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                    <Grid>
                        <!-- PERSONAL INFORMATION TAB -->
                        <Grid x:Name="panelPersonal" Visibility="Visible">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Personal Details Section -->
                            <StackPanel Grid.Row="0">
                                <TextBlock Text="Personal Details" FontSize="16" FontWeight="SemiBold" 
                                          Foreground="#333" Margin="0,0,0,18"/>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="40"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Full Name" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtFullName" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                        <TextBlock Text="Date of Birth" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtBirthDate" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                        <TextBlock Text="Age" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtAge" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                        <TextBlock Text="Gender" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtGender" Text="—" FontSize="14" FontWeight="Medium"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Phone Number" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtContact" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                        <TextBlock Text="Email" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtEmail" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                        <TextBlock Text="Address" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                        <TextBlock x:Name="txtAddress" Text="—" FontSize="14" FontWeight="Medium" TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>

                            <!-- Medical Information Section -->
                            <Border Grid.Row="1" Background="#F9F9F9" CornerRadius="8" 
                                   Padding="18" Margin="0,25,0,0">
                                <StackPanel>
                                    <TextBlock Text="Medical Information" FontSize="16" FontWeight="SemiBold" 
                                              Foreground="#333" Margin="0,0,0,18"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="40"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Blood Type" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtBloodType" Text="N/A" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                            <TextBlock Text="Height" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtHeight" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                            <TextBlock Text="Weight" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtWeight" Text="—" FontSize="14" FontWeight="Medium"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Allergies" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtAllergies" Text="None reported" FontSize="14" FontWeight="Medium" TextWrapping="Wrap"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Current Conditions Section -->
                            <Border Grid.Row="2" Background="#FFF8E1" CornerRadius="8" 
                                   Padding="18" Margin="0,18,0,0">
                                <StackPanel>
                                    <TextBlock Text="Current Conditions" FontSize="16" FontWeight="SemiBold" 
                                              Foreground="#333" Margin="0,0,0,18"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="40"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0">
                                            <TextBlock Text="Primary Diagnosis" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtPrimaryDiagnosis" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                            <TextBlock Text="Secondary Diagnosis" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtSecondaryDiagnosis" Text="—" FontSize="14" FontWeight="Medium"/>
                                        </StackPanel>

                                        <StackPanel Grid.Column="2">
                                            <TextBlock Text="Last Visit" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtLastVisit" Text="—" FontSize="14" FontWeight="Medium" Margin="0,0,0,18"/>

                                            <TextBlock Text="Next Appointment" FontSize="12" Foreground="#999" Margin="0,0,0,5"/>
                                            <TextBlock x:Name="txtNextAppointment" Text="—" FontSize="14" FontWeight="Medium" Foreground="#4CAF50"/>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- Clinical Notes -->
                            <StackPanel Grid.Row="3" Margin="0,25,0,0">
                                <TextBlock Text="Clinical Notes" FontSize="16" FontWeight="SemiBold" 
                                          Foreground="#333" Margin="0,0,0,12"/>
                                <Border Background="#F9F9F9" CornerRadius="8" Padding="15">
                                    <TextBlock x:Name="txtClinicalNotes" 
                                              Text="No clinical notes available." 
                                              TextWrapping="Wrap" FontSize="13" Foreground="#666" LineHeight="22"/>
                                </Border>
                            </StackPanel>
                        </Grid>

                        <!-- MEDICAL HISTORY TAB -->
                        <Grid x:Name="panelMedical" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,18">
                                <TextBlock Text="Medical History Timeline" FontSize="18" FontWeight="SemiBold" 
                                          Foreground="#333" VerticalAlignment="Center"/>
                                <Button Content="+ Add Record" Click="BtnAddMedicalHistory_Click"
                                       HorizontalAlignment="Right" Style="{StaticResource PrimaryButton}"/>
                            </Grid>

                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="icMedicalHistory">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F9F9F9" CornerRadius="8" Padding="15" Margin="0,0,0,12">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Timeline Indicator -->
                                                    <StackPanel Grid.Column="0" Margin="0,0,15,0">
                                                        <Ellipse Width="12" Height="12" Fill="#4CAF50"/>
                                                        <Rectangle Width="2" Height="60" Fill="#E0E0E0" 
                                                                  HorizontalAlignment="Center" Margin="0,3,0,0"/>
                                                    </StackPanel>

                                                    <!-- Content -->
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding VisitDate, StringFormat='MMMM dd, yyyy'}" 
                                                                  FontSize="13" Foreground="#999" Margin="0,0,0,5"/>
                                                        <TextBlock Text="{Binding Diagnosis}" FontSize="15" 
                                                                  FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,8"/>
                                                        <TextBlock Text="{Binding Treatment}" FontSize="13" 
                                                                  Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,10"/>

                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="*"/>
                                                            </Grid.ColumnDefinitions>

                                                            <StackPanel Grid.Column="0">
                                                                <TextBlock Text="Vital Signs" FontSize="11" 
                                                                          Foreground="#999" Margin="0,0,0,3"/>
                                                                <TextBlock FontSize="12" Foreground="#666">
                                                                    <Run Text="BP: "/><Run Text="{Binding BloodPressure, TargetNullValue='—'}"/>
                                                                    <Run Text=" | Temp: "/><Run Text="{Binding Temperature, StringFormat='{}{0}°C', TargetNullValue='—'}"/>
                                                                </TextBlock>
                                                            </StackPanel>

                                                            <StackPanel Grid.Column="1">
                                                                <TextBlock Text="Doctor" FontSize="11" 
                                                                          Foreground="#999" Margin="0,0,0,3"/>
                                                                <TextBlock Text="{Binding DoctorName}" 
                                                                          FontSize="12" Foreground="#666"/>
                                                            </StackPanel>
                                                        </Grid>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <!-- Empty State -->
                            <StackPanel x:Name="pnlNoMedicalHistory" Grid.Row="1" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="Collapsed">
                                <materialDesign:PackIcon Kind="ClipboardText" Width="50" Height="50" Foreground="#CCC"/>
                                <TextBlock Text="No medical history records" Foreground="#999" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Grid>

                        <!-- VISIT HISTORY TAB -->
                        <Grid x:Name="panelVisits" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Visit History" FontSize="18" 
                                      FontWeight="SemiBold" Foreground="#333" Margin="0,0,0,18"/>

                            <DataGrid Grid.Row="1" x:Name="dgVisitHistory" 
                                     AutoGenerateColumns="False"
                                     CanUserAddRows="False"
                                     IsReadOnly="True"
                                     HeadersVisibility="Column"
                                     GridLinesVisibility="Horizontal"
                                     HorizontalGridLinesBrush="#F0F0F0"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     RowHeight="45"
                                     ColumnHeaderHeight="40">
                                <DataGrid.ColumnHeaderStyle>
                                    <Style TargetType="DataGridColumnHeader">
                                        <Setter Property="Background" Value="#F5F5F5"/>
                                        <Setter Property="Foreground" Value="#666"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                        <Setter Property="FontSize" Value="12"/>
                                        <Setter Property="Padding" Value="12,10"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                    </Style>
                                </DataGrid.ColumnHeaderStyle>
                                <DataGrid.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <Setter Property="Padding" Value="12,0"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="VerticalAlignment" Value="Center"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="DataGridCell">
                                                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                                        <ContentPresenter VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </DataGrid.CellStyle>
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Date" Binding="{Binding VisitDate, StringFormat='MMM dd, yyyy'}" Width="120"/>
                                    <DataGridTextColumn Header="Type" Binding="{Binding VisitType}" Width="120"/>
                                    <DataGridTextColumn Header="Diagnosis" Binding="{Binding Diagnosis}" Width="*"/>
                                    <DataGridTextColumn Header="Doctor" Binding="{Binding DoctorName}" Width="150"/>
                                    <DataGridTemplateColumn Header="Actions" Width="100">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button Content="View" Click="BtnViewVisit_Click" 
                                                       Padding="10,5" Background="#2196F3" 
                                                       Foreground="White" BorderThickness="0"
                                                       FontSize="12" Cursor="Hand">
                                                    <Button.Template>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Button.Template>
                                                </Button>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>

                            <!-- Empty State -->
                            <StackPanel x:Name="pnlNoVisits" Grid.Row="1" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="Collapsed">
                                <materialDesign:PackIcon Kind="CalendarBlank" Width="50" Height="50" Foreground="#CCC"/>
                                <TextBlock Text="No visit history" Foreground="#999" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Grid>

                        <!-- PRESCRIPTIONS TAB -->
                        <Grid x:Name="panelPrescription" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Grid Grid.Row="0" Margin="0,0,0,18">
                                <TextBlock Text="Prescription History" FontSize="18" 
                                          FontWeight="SemiBold" Foreground="#333" 
                                          VerticalAlignment="Center"/>
                                <Button Content="+ New Prescription" Click="BtnNewPrescription_Click"
                                       HorizontalAlignment="Right" 
                                       Style="{StaticResource PrimaryButton}"/>
                            </Grid>

                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                <ItemsControl x:Name="icPrescriptions">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="#F9F9F9" CornerRadius="8" 
                                                   Padding="18" Margin="0,0,0,12">
                                                <Grid>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                        <RowDefinition Height="Auto"/>
                                                    </Grid.RowDefinitions>

                                                    <!-- Header -->
                                                    <Grid Grid.Row="0" Margin="0,0,0,12">
                                                        <StackPanel>
                                                            <TextBlock Text="{Binding PrescriptionId}" 
                                                                      FontSize="15" FontWeight="SemiBold" 
                                                                      Foreground="#333"/>
                                                            <TextBlock Text="{Binding CreatedAt, StringFormat='Prescribed on {0:MMMM dd, yyyy}'}" 
                                                                      FontSize="12" Foreground="#999" 
                                                                      Margin="0,4,0,0"/>
                                                        </StackPanel>
                                                        <Button Content="View Details" 
                                                               Click="BtnViewPrescription_Click"
                                                               HorizontalAlignment="Right"
                                                               Padding="12,6" Background="#2196F3" 
                                                               Foreground="White" BorderThickness="0"
                                                               FontSize="12" Cursor="Hand">
                                                            <Button.Template>
                                                                <ControlTemplate TargetType="Button">
                                                                    <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="{TemplateBinding Padding}">
                                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                                    </Border>
                                                                </ControlTemplate>
                                                            </Button.Template>
                                                        </Button>
                                                    </Grid>

                                                    <!-- Diagnosis -->
                                                    <StackPanel Grid.Row="1" Margin="0,0,0,12">
                                                        <TextBlock Text="Diagnosis" FontSize="11" 
                                                                  Foreground="#999" Margin="0,0,0,4"/>
                                                        <TextBlock Text="{Binding PrimaryDiagnosis}" 
                                                                  FontSize="13" Foreground="#666"/>
                                                    </StackPanel>

                                                    <!-- Medicines -->
                                                    <StackPanel Grid.Row="2">
                                                        <TextBlock Text="Medicines Prescribed" 
                                                                  FontSize="11" Foreground="#999" 
                                                                  Margin="0,0,0,8"/>
                                                        <ItemsControl ItemsSource="{Binding Medicines}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Border Background="White" 
                                                                           CornerRadius="6" Padding="10" 
                                                                           Margin="0,0,0,6"
                                                                           BorderBrush="#E8E8E8" BorderThickness="1">
                                                                        <Grid>
                                                                            <StackPanel>
                                                                                <TextBlock Text="{Binding MedicineName}" 
                                                                                          FontSize="13" 
                                                                                          FontWeight="Medium" 
                                                                                          Foreground="#333"/>
                                                                                <TextBlock FontSize="11" 
                                                                                          Foreground="#666" 
                                                                                          Margin="0,3,0,0">
                                                                                    <Run Text="{Binding Dosage}"/>
                                                                                    <Run Text=" • "/>
                                                                                    <Run Text="{Binding Frequency}"/>
                                                                                    <Run Text=" • "/>
                                                                                    <Run Text="{Binding Duration}"/>
                                                                                </TextBlock>
                                                                            </StackPanel>
                                                                        </Grid>
                                                                    </Border>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>

                            <!-- Empty State -->
                            <StackPanel x:Name="pnlNoPrescriptions" Grid.Row="1" 
                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                       Visibility="Collapsed">
                                <materialDesign:PackIcon Kind="Pill" Width="50" Height="50" Foreground="#CCC"/>
                                <TextBlock Text="No prescriptions" Foreground="#999" Margin="0,10,0,0"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</UserControl>